# Hier wird das Docker Image f√ºr den MySQL und Zabbix Proxy Container spezifiziert.
# Es gibt zwei verschiedenen Realease Cheannels (testing und stable)
versions:
    STABLE:
        package_version: "1.0.0"
        dynamic_secrets:
          - mysql_password
          - mysql_root_pw
        containers:
          - name: zabbix_mysql_container
            hostname: zabbix-mysql-container
            image: ubuntu/mysql:8.0-20.04_edge
            privileged: false
            config:
              static:
                TZ: UTC
                MYSQL_USER: zabbix
                MYSQL_DATABASE: zabbix_proxy
              
              secrets:
                MYSQL_PASSWORD: mysql_password
                MYSQL_ROOT_PASSWORD: mysql_root_pw

          - name: zabbix_agent2_container
            hostname: zabbix-agent2-container
            image: zabbix/zabbix-agent:6.0-ubuntu-latest
            privileged: true
            config:
              static:
                ZBX_ACTIVE_ALLOW: false
                ZBX_PASSIVESERVERS: zabbix-proxy-container

          - name: zabbix_proxy_container
            hostname: zabbix-proxy-container
            image: noahnc/smartmonitoring-proxy:6.0
            privileged: false
            files:
              - name: psk_encryption_key
                host_path: psk_key_file
                container_path: /var/lib/zabbix/ssl/keys/key.psk
            ports:
              - host_port: 10051
                container_port: 10051
                protocol: tcp
            config:
              dynamic: #Looks up specified key in local config of container
                ZBX_HOSTNAME: proxy_name

              static:
                ZBX_SERVER_HOST: "monitoring.smartcollab.ch"
                MYSQL_USER: zabbix
                DB_SERVER_HOST: zabbix-mysql-container
                ZBX_TIMEOUT: 15
                ZBX_STARTPOLLERS: 10
                ZBX_DEBUGLEVEL: 4
                ZBX_TLSCONNECT: psk
                ZBX_TLSACCEPT: psk
                ZBX_TLSPSKIDENTITY: PSK_KEY
                ZBX_TLSPSKFILE: /var/lib/zabbix/ssl/keys/key.psk

              secrets: # gets replaced with generated secret
                MYSQL_PASSWORD: mysql_password

    TESTING:
        package_version: "1.0.1"
        dynamic_secrets:
          - mysql_password
          - mysql_root_pw
        containers:
          - name: zabbix_mysql_container
            hostname: zabbix-mysql-container
            image: ubuntu/mysql:8.0-20.04_edge
            privileged: false
            config:
              static:
                TZ: UTC
                MYSQL_USER: zabbix
                MYSQL_DATABASE: zabbix_proxy
              
              secrets:
                MYSQL_PASSWORD: mysql_password
                MYSQL_ROOT_PASSWORD: mysql_root_pw

          - name: zabbix_agent2_container
            hostname: zabbix-agent2-container
            image: zabbix/zabbix-agent:6.0-ubuntu-latest
            privileged: true
            config:
              static:
                ZBX_ACTIVE_ALLOW: false
                ZBX_PASSIVESERVERS: zabbix-proxy-container

          - name: zabbix_proxy_container
            hostname: zabbix-proxy-container
            image: noahnc/smartmonitoring-proxy:6.0
            privileged: false
            files:
              - name: psk_encryption_key
                host_path: psk_key_file
                container_path: /var/lib/zabbix/ssl/keys/key.psk
            ports:
              - host_port: 10051
                container_port: 10051
                protocol: tcp
            config:
              dynamic: #Looks up specified key in local config of container
                ZBX_HOSTNAME: proxy_name

              static:
                ZBX_SERVER_HOST: "monitoring.smartcollab.ch"
                MYSQL_USER: zabbix
                DB_SERVER_HOST: zabbix-mysql-container
                ZBX_TIMEOUT: 15
                ZBX_STARTPOLLERS: 10
                ZBX_DEBUGLEVEL: 4
                ZBX_TLSCONNECT: psk
                ZBX_TLSACCEPT: psk
                ZBX_TLSPSKIDENTITY: PSK_KEY
                ZBX_TLSPSKFILE: /var/lib/zabbix/ssl/keys/key.psk

              secrets: # gets replaced with generated secret
                MYSQL_PASSWORD: mysql_password
